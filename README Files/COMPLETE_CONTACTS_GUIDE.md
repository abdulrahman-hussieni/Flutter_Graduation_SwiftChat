# ๐ฏ ุฏููู ูุธุงู ุงููููุชุงูุชุณ ุงููุงูู - SwiftChat

## โ ุงูุชุญุฏูุซุงุช ุงููู ุงุชุนููุช ุฏูููุชู

### 1๏ธโฃ ูุธุงู Firebase Sub-Collections ุดุบุงู 100%
**ุงููููู:**
```
๐ Firestore Database
  โโโ ๐ users
       โโโ ๐ {userId}                    โ ูู ูุณุชุฎุฏู
            โโโ name: "Mahmoud"
            โโโ email: "mahmoud@gmail.com"
            โโโ ๐ contacts               โ Sub-collection ููุฃุตุฏูุงุก โ
                 โโโ ๐ {contactId1}
                 โ    โโโ name: "Ahmed"
                 โ    โโโ email: "ahmed@gmail.com"
                 โโโ ๐ {contactId2}
                      โโโ name: "Ali"
                      โโโ email: "ali@gmail.com"
```

### 2๏ธโฃ ุงูุฃููููุฉ ุจุชุชุบูุฑ ุชููุงุฆูุงู โ
- **ูุจู ุงูุฅุถุงูุฉ:** ุฃููููุฉ โ (person_add) ุจุงูููู ุงูุฃุฒุฑู
- **ุจุนุฏ ุงูุฅุถุงูุฉ:** ุฃููููุฉ โ (person_remove) ุจุงูููู ุงูุฃุญูุฑ
- **ููุง ุชุถุบุท:** ุจูุถูู/ูุดูู ุงูุดุฎุต ูู ุงููููุชุงูุชุณ ูุชุธูุฑ ุฑุณุงูุฉ

### 3๏ธโฃ ุงูุจุญุซ ูุงูุฅุถุงูุฉ ุงูุณุฑูุนุฉ
- ุงุจุญุซ ุจุงูุงุณู โ ูุธูุฑูู ูู ุงููุชุงุฆุฌ
- ูู ูุชูุฌุฉ ูููุง ุฒุฑุงุฑูู:
  - ๐ฌ **Chat** - ูุญุงุฏุซุฉ ูุจุงุดุฑุฉ
  - โ/โ **Add/Remove** - ุฅุถุงูุฉ ุฃู ุญุฐู ูู ุงููููุชุงูุชุณ

### 4๏ธโฃ New Group ุจูุดุชุบู ุตุญ โ
- ููุง ุชุฏูุณ **New Group** ุจูุธูุฑูู **ุงููููุชุงูุชุณ ุจุชูุนู ุจุณ**
- ูู ูููุด ูููุชุงูุชุณุ ุจูุธูุฑูู ุฑุณุงูุฉ: "Add contacts first to create a group"
- ุชูุฏุฑ ุชุฎุชุงุฑ ุฃู ุนุฏุฏ ูู ุงููููุชุงูุชุณ ูุชุนูู ุฌุฑูุจ

## ๐ Firebase Security Rules (ููู ุฌุฏุงู!)

**ูุงุฒู ุชูุณุฎ ุงูููุงุนุฏ ุฏู ูุชุญุทูุง ูู Firebase Console:**

### ุฎุทูุงุช ุงูุชุทุจูู:

1. **ุงูุชุญ Firebase Console:**
   - ุฑูุญ https://console.firebase.google.com/
   - ุงุฎุชุงุฑ ูุดุฑูุนู: **graduation_swiftchat**

2. **ุนุฏูู Firestore Rules:**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ **Firestore Database**
   - ุงุถุบุท ุนูู ุชุงุจ **Rules**
   - ุงุญุฐู ูู ุงูููุงุนุฏ ุงููุฏููุฉ
   - ุงูุณุฎ ุงูููุงุนุฏ ูู ููู `firestore.rules` (ุงููู ูู ุงูู root)
   - ุฃู ุงุณุชุฎุฏู ุงูููุงุนุฏ ุงููู ุชุญุช:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users Collection
    match /users/{userId} {
      // ุฃู ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู ููุฏุฑ ููุฑุฃ ูุนูููุงุช ุฃู ูุณุชุฎุฏู
      allow read: if request.auth != null;
      
      // ูู ูุณุชุฎุฏู ููุฏุฑ ูุนุฏู ุนูู ุจูุงูุงุชู ูู ุจุณ
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // Sub-collection: contacts (ุงูุฃุตุฏูุงุก)
      match /contacts/{contactId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // Sub-collection: calls (ุงูููุงููุงุช)
      match /calls/{callId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // Chats Collection
    match /chats/{chatId} {
      allow read, write: if request.auth != null;
      
      match /messages/{messageId} {
        allow read, write: if request.auth != null;
      }
    }
    
    // Groups Collection
    match /groups/{groupId} {
      allow read, write: if request.auth != null;
      
      match /messages/{messageId} {
        allow read, write: if request.auth != null;
      }
    }
    
    // Notifications
    match /notification/{userId} {
      allow read, write: if request.auth != null;
      
      match /call/{callId} {
        allow read, write: if request.auth != null;
      }
    }
  }
}
```

3. **ุงุถุบุท Publish:**
   - ุงุถุบุท ุงูุฒุฑุงุฑ ุงูุฃุฒุฑู **Publish**
   - ุงุณุชูู 1-2 ุฏูููุฉ ุนุดุงู ุงูุชุญุฏูุซุงุช ุชุทุจู

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ๐ ุงูุจุญุซ ูุฅุถุงูุฉ ูููุชุงูุช:

1. **ุงูุชุญ ุงูุชุทุจูู**
2. ุฑูุญ ุชุงุจ **Contacts**
3. ุงุถุบุท **New contact**
4. ุงูุชุจ ุงุณู ุงูุดุฎุต (ูุซูุงู: "Mahmoud")
5. ุงุถุบุท ๐ ููุจุญุซ
6. ููุธูุฑูู ูู ุงููุงุณ ุงููู ุงุณููู ููู "Mahmoud"
7. ุดูู ุงูุฃููููุฉ ุฌูุจ ูู ุดุฎุต:
   - โ ูู ุดุงูู โ (ุฃุฒุฑู) โ ุงูุดุฎุต **ูุด ูู ุงููููุชุงูุชุณ**
   - โ ูู ุดุงูู โ (ุฃุญูุฑ) โ ุงูุดุฎุต **ููุฌูุฏ ูู ุงููููุชุงูุชุณ**
8. ุงุถุบุท โ ูุฅุถุงูุฉ ุงูุดุฎุต
9. ููุชุบูุฑ ุงูุฃููููุฉ ูู โ ููุฑุงู
10. ุฑูุญ Contacts ููุชูุงูู ุงูุดุฎุต ูู ุงููุงุฆูุฉ

### ๐ฌ ุจุฏุก ูุญุงุฏุซุฉ ูุจุงุดุฑุฉ:

- ูู ูุชุงุฆุฌ ุงูุจุญุซุ ุงุถุบุท ๐ฌ ุฌูุจ ุฃู ุดุฎุต
- ูููุชุญูู ุตูุญุฉ ุงููุญุงุฏุซุฉ ูุนุงู ูุจุงุดุฑุฉ
- ูุด ูุงุฒู ุชุถููู ูู ุงููููุชุงูุชุณ ุนุดุงู ุชูููู

### ๐๏ธ ุญุฐู ูููุชุงูุช:

1. ุงุจุญุซ ุนู ุงูุดุฎุต ุงููู ุนุงูุฒ ุชุดููู
2. ูุชูุงูู ุงูุฃููููุฉ โ (ุฃุญูุฑ)
3. ุงุถุบุท ุนูููุง
4. ููุชุดุงู ูู ุงููููุชุงูุชุณ ูุชุธูุฑ ุฑุณุงูุฉ: "Removed from contacts"
5. ุงูุฃููููุฉ ูุชุฑุฌุน โ (ุฃุฒุฑู) ุชุงูู

### ๐ฅ ุนูู ุฌุฑูุจ:

1. ุฑูุญ ุชุงุจ **Contacts**
2. ุงุถุบุท **New Group**
3. ููุธูุฑูู **ูููุชุงูุชุณู ุจุณ** (ูุด ูู ุงููุณุชุฎุฏููู)
4. ุงุฎุชุงุฑ ุงูุฃุดุฎุงุต ุงููู ุนุงูุฒูู ูู ุงูุฌุฑูุจ
5. ุงุถุบุท ุงูุณูู โก๏ธ
6. ุงูุชุจ ุงุณู ุงูุฌุฑูุจ
7. โ ุงูุฌุฑูุจ ุงุชุนูู!

### โ๏ธ ูู New Group ูุงุถู:

- ูุนูุงูุง ูููุด ูููุชุงูุชุณ ุนูุฏู
- ูุงุฒู ุชุถูู ูููุชุงูุชุณ ุงูุฃูู
- ุจุนุฏูู ุชูุฏุฑ ุชุนูู ุฌุฑูุจ ูุนุงูู

## ๐ง ุงููููุงุช ุงููู ุงุชุนุฏูุช

### 1. `lib/controllers/contact_controller.dart`
**ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ:**

```dart
// ุฅุถุงูุฉ ูููุชุงูุช
Future<void> saveContact(UserModel user)

// ุญุฐู ูููุชุงูุช
Future<void> deleteContact(String userId)

// ูุญุต ูู ุงูุดุฎุต ูู ุงููููุชุงูุชุณ ููุง ูุฃ
Future<bool> isContact(String userId)

// ุงุณุชุฑุฌุงุน ูุงุฆูุฉ ุงููููุชุงูุชุณ (Stream)
Stream<List<UserModel>> getContacts()
```

**ูููุฒุงุช:**
- โ ุฅุถุงูุฉ print statements ุนุดุงู ุชุดูู ุงูู logs
- โ ูุญุต ุงููููุชุงูุช ูุจู ุงูุฅุถุงูุฉ/ุงูุญุฐู
- โ Stream ูุชุญุฏุซ ุชููุงุฆูุงู

### 2. `lib/pages/contact_page/add_contact_page.dart`
**ุงูุชุบููุฑุงุช:**
- โ ุงุณุชุฎุฏุงู `FutureBuilder` ููุญุต ุญุงูุฉ ุงููููุชุงูุช
- โ ุงูุฃููููุฉ ุจุชุชุบูุฑ ุชููุงุฆูุงู:
  - `Icons.person_add` (ุฃุฒุฑู) ูู ูุด ูู ุงููููุชุงูุชุณ
  - `Icons.person_remove` (ุฃุญูุฑ) ูู ูู ุงููููุชุงูุชุณ
- โ ุงูุฒุฑุงุฑ ุจูุถูู ุฃู ูุญุฐู ุญุณุจ ุงูุญุงูุฉ
- โ ุฑุณุงูุฉ Snackbar ุจุชุธูุฑ ุจุนุฏ ูู ุนูููุฉ

**ุงูููุฏ ุงูููู:**
```dart
FutureBuilder<bool>(
  future: contactController.isContact(user.id ?? ''),
  builder: (context, snapshot) {
    final isInContacts = snapshot.data ?? false;
    
    return IconButton(
      icon: Icon(
        isInContacts ? Icons.person_remove : Icons.person_add,
      ),
      color: isInContacts ? Colors.red : Colors.blue,
      onPressed: () async {
        if (isInContacts) {
          await contactController.deleteContact(user.id!);
        } else {
          await contactController.saveContact(user);
        }
        foundUsers.refresh(); // ุชุญุฏูุซ ุงููุงุฌูุฉ
      },
    );
  },
)
```

### 3. `lib/pages/Groups/NewGroup/new_group.dart`
**ุงูุชุบููุฑุงุช:**
- โ ุชุบููุฑ ุงููุต ูู "Contacts on Sampark" ุฅูู "My Contacts"
- โ ุฅุถุงูุฉ ูุญุต ูู ุงููุงุฆูุฉ ูุงุถูุฉ
- โ ุฑุณุงูุฉ ูุงุถุญุฉ: "Add contacts first to create a group"
- โ ุจูุณุชุฎุฏู `getContacts()` ุนุดุงู ูุฌูุจ ุงููููุชุงูุชุณ ุจุณ

### 4. `firestore.rules` (ููู ุฌุฏูุฏ)
- โ ููุงุนุฏ ุฃูุงู ูุงููุฉ ููู ุงูู collections
- โ ุฏุนู ุงูู sub-collections (contacts, calls, messages)
- โ ุตูุงุญูุงุช ูุงุถุญุฉ ูููุธูุฉ

### 5. `firestore_test.dart` (ููู ุงุฎุชุจุงุฑ)
- ููู ูุงุฎุชุจุงุฑ Firebase operations
- ุงุณุชุฎุฏูู ูู ูุงุฌูุช ุฃู ูุดุงูู ูู Firebase

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### โ ูู ุธูุฑูู: "Permission Denied"

**ุงูุณุจุจ:** Firebase Rules ูุด ูุชุทุจูุฉ ุตุญ

**ุงูุญู:**
1. ุงูุชุญ Firebase Console
2. ุฑูุญ Firestore Database โ Rules
3. ุงูุณุฎ ุงูููุงุนุฏ ูู ููู `firestore.rules`
4. ุงุถุบุท **Publish**
5. ุงุณุชูู ุฏูููุฉ ูุงุญุฏุฉ
6. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู

### โ ูู ุงูุฃููููุฉ ูุด ุจุชุชุบูุฑ

**ุงูุณุจุจ:** ูุดููุฉ ูู ุงูู FutureBuilder

**ุงูุญู:**
1. ุชุฃูุฏ ุฅูู ุนููุช `flutter clean`
2. ุดุบู ุงูุชุทุจูู ุชุงูู
3. ูู ุงููุดููุฉ ุจุงููุฉุ ุงุถุบุท Hot Reload (R)

### โ ูู New Group ูุงุถู

**ุงูุณุจุจ:** ูููุด ูููุชุงูุชุณ ูู Firebase

**ุงูุญู:**
1. ุงูุชุญ Firebase Console
2. ุฑูุญ Firestore Database
3. ุดูู ุงูู path: `users/{yourUserId}/contacts/`
4. ูู ูููุด ุญุงุฌุฉุ ุถูู ูููุชุงูุชุณ ูู ุงูุชุทุจูู
5. ุงุณุชุฎุฏู AddContactPage ุนุดุงู ุชุถูู

### โ ูู ุงูุจุญุซ ูุด ุฑุงุถู ูุดุชุบู

**ุงูุญู:**
1. ุชุฃูุฏ ุฅูู ูุณุฌู ุฏุฎูู
2. ุชุฃูุฏ ุฅู ูู users ูู ุงูู Firestore
3. ุฌุฑุจ ุชุจุญุซ ุจุญุฑูู ููููุฉ

## ๐งช ุงุฎุชุจุงุฑ Firebase

ุงุณุชุฎุฏู ููู `firestore_test.dart` ูุงุฎุชุจุงุฑ Firebase:

```dart
import 'firestore_test.dart';

// ูู ุฃู ุตูุญุฉ ุฃู controller
final tester = FirestoreTest();
await tester.runAllTests();
```

**ููุฎุชุจุฑ:**
- โ ุญูุธ ูููุชุงูุช
- โ ูุฑุงุกุฉ ุงููููุชุงูุชุณ
- โ Stream updates
- โ ุญุฐู ูููุชุงูุช

ุดูู ุงูู logs ูู ุงูู terminal ุนุดุงู ุชุดูู ุงููุชุงูุฌ.

## ๐ Firebase Structure ุงูููุงุฆูุฉ

```
๐ Firestore Database
  โโโ ๐ users
  โ    โโโ ๐ user1_id
  โ    โ    โโโ name: "Mahmoud"
  โ    โ    โโโ email: "mahmoud@gmail.com"
  โ    โ    โโโ ๐ contacts โ
  โ    โ    โ    โโโ ๐ user2_id
  โ    โ    โ    โ    โโโ name: "Ahmed"
  โ    โ    โ    โ    โโโ email: "ahmed@gmail.com"
  โ    โ    โ    โโโ ๐ user3_id
  โ    โ    โ         โโโ name: "Ali"
  โ    โ    โ         โโโ email: "ali@gmail.com"
  โ    โ    โโโ ๐ calls โ
  โ    โ         โโโ ...
  โ    โโโ ๐ user2_id
  โ         โโโ ...
  โ
  โโโ ๐ chats
  โ    โโโ ๐ {chatId}
  โ         โโโ sender: {...}
  โ         โโโ receiver: {...}
  โ         โโโ ๐ messages
  โ              โโโ ...
  โ
  โโโ ๐ groups
       โโโ ๐ {groupId}
            โโโ name: "My Group"
            โโโ members: [...]
            โโโ ๐ messages
                 โโโ ...
```

## ๐ฎ UI/UX

### ุตูุญุฉ ุงูุจุญุซ (AddContactPage)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ Search by name                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ค  Mahmoud Abdelghani             โ
โ      mahmoud@gmail.com              โ
โ                        [โ] [๐ฌ]    โ  โ ูู ูุด ูู ุงููููุชุงูุชุณ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ค  Mahmoud Ahmed                  โ
โ      mahmoud2@gmail.com             โ
โ                        [โ] [๐ฌ]    โ  โ ูู ูู ุงููููุชุงูุชุณ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูุฑุณุงุฆู (Snackbars)
- โ **Success** (ุฃุฎุถุฑ): "Ahmed added to contacts"
- โ๏ธ **Removed** (ุจุฑุชูุงูู): "Ahmed removed from contacts"
- โ **Error** (ุฃุญูุฑ): "Please enter a name"

## ๐ ุฎุทูุงุช ุงูุชุดุบูู ุงูููุงุฆูุฉ

### 1. ุชุทุจูู Firebase Rules:
```bash
# ุฑูุญ Firebase Console
# ุงูุณุฎ ูู ููู firestore.rules
# ุงูุตููุง ูู Firestore โ Rules
# ุงุถุบุท Publish
```

### 2. ุชูุธูู ุงูุจูุงุก:
```bash
flutter clean
flutter pub get
```

### 3. ุชุดุบูู ุงูุชุทุจูู:
```bash
flutter run
```

### 4. ุงุฎุชุจุงุฑ ุงูููุฒุงุช:
- โ ุณุฌู ุฏุฎูู
- โ ุงุจุญุซ ุนู ุดุฎุต
- โ ุงุถุบุท โ ุนุดุงู ุชุถููู
- โ ุดูู ุงูุฃููููุฉ ุงุชุบูุฑุช ูู โ
- โ ุฑูุญ Contacts ูุดููู ูู ุงููุงุฆูุฉ
- โ ุงุถุบุท New Group ูุดูู ุงููููุชุงูุชุณ ุจุชูุนู
- โ ุงุฎุชุงุฑ ูุงุณ ูุงุนูู ุฌุฑูุจ

## ๐ฏ ุงููููุฒุงุช ุงูููุงุฆูุฉ

### โ ูุธุงู ูููุชุงูุชุณ ูุงูู
- ุฅุถุงูุฉ ูููุชุงูุช โ
- ุญุฐู ูููุชุงูุช โ
- ุนุฑุถ ุงููููุชุงูุชุณ โ
- ูุญุต ูู ููุฌูุฏ ููุง ูุฃ โ
- Stream ูุชุญุฏุซ ุชููุงุฆูุงู โ

### โ ูุงุฌูุฉ ุฐููุฉ
- ุงูุฃููููุฉ ุจุชุชุบูุฑ ุชููุงุฆูุงู โ
- ุฑุณุงุฆู ูุงุถุญุฉ โ
- ุชุญุฏูุซ ููุฑู โ
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ โ

### โ ูุธุงู Groups ุดุบุงู
- ุจูุนุฑุถ ุงููููุชุงูุชุณ ุจุณ โ
- ุฑุณุงูุฉ ูู ูููุด ูููุชุงูุชุณ โ
- ุชูุฏุฑ ุชุนูู ุฌุฑูุจ ูุนูุงู โ

### โ Firebase ุตุญ
- Sub-collections ุดุบุงูุฉ โ
- Security Rules ูุญููุฉ โ
- Streams ุจุชุชุญุฏุซ โ
- Print logs ูุงุถุญุฉ โ

## ๐ ููุญูุธุงุช ูููุฉ

1. **Firebase Rules ูุงุฒู ุชุชุทุจู ุนุดุงู ูุดุชุบู**
2. **ุงููููุชุงูุชุณ ุจุชุชุญูุธ ูู sub-collection ุฌูุง ูู user**
3. **New Group ุจูุนุฑุถ ุงููููุชุงูุชุณ ุจุชูุนู ุจุณ**
4. **ุงูุฃููููุฉ ุจุชุชุบูุฑ ุชููุงุฆูุงู ุจุฏูู hot reload**
5. **ูู ุนูููุฉ ูููุง print logs ุชูุฏุฑ ุชุชุงุจุนูุง**

## ๐ ูููุทูุฑูู

### ููู ุชุถูู ููุฒุฉ ุฌุฏูุฏุฉ ูููููุชุงูุชุณ:

```dart
// ูู ContactController
Future<void> blockContact(String userId) async {
  await db
      .collection("users")
      .doc(auth.currentUser!.uid)
      .collection("blocked")  // sub-collection ุฌุฏูุฏุฉ
      .doc(userId)
      .set({...});
}
```

### ููู ุชุถูู Firebase Rule ุฌุฏูุฏุฉ:

```javascript
// ูู firestore.rules
match /users/{userId} {
  match /blocked/{blockedId} {
    allow read, write: if request.auth.uid == userId;
  }
}
```

---

**โจ ูู ุญุงุฌุฉ ุดุบุงูุฉ ุฏูููุชู 100%!**

**๐ ูุธุงู ุงููููุชุงูุชุณ ูุงูู Groups ุฌุงูุฒูู ููุงุณุชุฎุฏุงู!**
